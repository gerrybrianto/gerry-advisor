{"ast":null,"code":"import { forkJoin, Observable } from 'rxjs';\nimport { map, switchMap } from 'rxjs/operators';\nimport { addRestaurant, removeRestaurant } from './store/restaurants.actions';\nimport { selectRestaurants } from './store/restaurants.selector';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ngrx/store\";\nimport * as i2 from \"./restaurant-list/restaurants.service\";\nimport * as i3 from \"@angular/google-maps\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"./restaurant-list/restaurant-list.component\";\nimport * as i6 from \"@angular/router\";\n\nfunction AppComponent_map_marker_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"map-marker\", 9);\n  }\n\n  if (rf & 2) {\n    const position_r1 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"position\", position_r1)(\"options\", ctx_r0.markerOptions);\n  }\n}\n\nexport class AppComponent {\n  constructor(store, restaurantsService) {\n    this.store = store;\n    this.restaurantsService = restaurantsService;\n    this.title = 'gerry-advisor';\n    this.googleMapOptions = {};\n    this.map = google.maps.Map;\n    this.infoWindow = google.maps.InfoWindow;\n    this.restaurants$ = this.store.select(selectRestaurants); //this.restaurantCollection$ = this.store.select(selectRestaurantCollection);\n\n    this.restaurantsWithRatings$ = new Observable();\n    this.markerInfos = {\n      titles: [],\n      positions: []\n    };\n    this.markerOptions = {\n      draggable: false\n    };\n  }\n\n  ngOnInit() {\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(position => {\n        const pos = {\n          lat: position.coords.latitude,\n          lng: position.coords.longitude\n        };\n        this.setMapPos(pos, 15);\n        this.restaurantsWithRatings$ = this.restaurantsService.getRestaurants(pos).pipe(map(restaurants => restaurants.map(restaurant => this.getRestaurantRatings(restaurant))), switchMap(restaurantsWithRatings$ => forkJoin(restaurantsWithRatings$)));\n        this.restaurantsWithRatings$.subscribe(restaurantsWithRatings => {\n          restaurantsWithRatings.map(restaurantWithRatings => {\n            this.setRestaurantMarkersInfos(restaurantWithRatings.restaurant);\n          });\n        });\n      });\n    } else {\n      // Browser doesn't support Geolocation\n      this.handleLocationError(false, this.infoWindow, this.map.getCenter());\n    }\n  }\n\n  onAdd(restaurantId) {\n    this.store.dispatch(addRestaurant({\n      restaurantId\n    }));\n  }\n\n  onRemove(restaurantId) {\n    this.store.dispatch(removeRestaurant({\n      restaurantId\n    }));\n  }\n\n  zoomOnRestaurant(restaurant) {\n    const pos = {\n      lat: restaurant.lat,\n      lng: restaurant.long\n    };\n    this.setMapPos(pos, 18);\n    console.log('gMapOptions: ', this.googleMapOptions);\n  }\n\n  setMapPos(pos, zoom) {\n    this.googleMapOptions = {\n      center: {\n        lat: pos.lat,\n        lng: pos.lng\n      },\n      zoom: zoom\n    };\n  }\n\n  setRestaurantMarkersInfos(restaurant) {\n    this.markerInfos.positions.push({\n      lat: restaurant.lat,\n      lng: restaurant.long\n    });\n    this.markerInfos.titles.push(restaurant.restaurantName);\n  }\n\n  getRestaurantRatings(restaurant) {\n    return this.restaurantsService.getReviews(restaurant.id).pipe(map(ratings => ({\n      restaurant,\n      ratings\n    })));\n  }\n\n  handleLocationError(browserHasGeolocation, infoWindow, pos) {\n    infoWindow.setPosition(pos);\n    infoWindow.setContent(browserHasGeolocation ? 'Error: The Geolocation service failed.' : \"Error: Your browser doesn't support geolocation.\");\n    infoWindow.open(this.map);\n  }\n\n}\n\nAppComponent.ɵfac = function AppComponent_Factory(t) {\n  return new (t || AppComponent)(i0.ɵɵdirectiveInject(i1.Store), i0.ɵɵdirectiveInject(i2.GooglePlacesService));\n};\n\nAppComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: AppComponent,\n  selectors: [[\"app-root\"]],\n  decls: 15,\n  vars: 5,\n  consts: [[1, \"page-container\"], [1, \"page-header\"], [1, \"page-content\"], [1, \"map-container\"], [1, \"map\", 3, \"options\"], [3, \"position\", \"options\", 4, \"ngFor\", \"ngForOf\"], [1, \"restaurants-list-container\"], [3, \"restaurantsWithRatings\", \"add\", \"zoomOnRestaurant\"], [1, \"page-footer\"], [3, \"position\", \"options\"]],\n  template: function AppComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0);\n      i0.ɵɵelement(1, \"header\", 1);\n      i0.ɵɵelementStart(2, \"div\", 2);\n      i0.ɵɵelementStart(3, \"section\", 3);\n      i0.ɵɵelementStart(4, \"h2\");\n      i0.ɵɵtext(5, \"Map\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(6, \"google-map\", 4);\n      i0.ɵɵtemplate(7, AppComponent_map_marker_7_Template, 1, 2, \"map-marker\", 5);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(8, \"section\", 6);\n      i0.ɵɵelementStart(9, \"h2\");\n      i0.ɵɵtext(10, \"Liste des restaurants\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(11, \"app-restaurant-list\", 7);\n      i0.ɵɵlistener(\"add\", function AppComponent_Template_app_restaurant_list_add_11_listener($event) {\n        return ctx.onAdd($event);\n      })(\"zoomOnRestaurant\", function AppComponent_Template_app_restaurant_list_zoomOnRestaurant_11_listener($event) {\n        return ctx.zoomOnRestaurant($event);\n      });\n      i0.ɵɵpipe(12, \"async\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(13, \"footer\", 8);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(14, \"router-outlet\");\n    }\n\n    if (rf & 2) {\n      i0.ɵɵadvance(6);\n      i0.ɵɵproperty(\"options\", ctx.googleMapOptions);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngForOf\", ctx.markerInfos.positions);\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"restaurantsWithRatings\", i0.ɵɵpipeBind1(12, 3, ctx.restaurantsWithRatings$));\n    }\n  },\n  directives: [i3.GoogleMap, i4.NgForOf, i3.MapMarker, i5.RestaurantListComponent, i6.RouterOutlet],\n  pipes: [i4.AsyncPipe],\n  styles: [\".page-content[_ngcontent-%COMP%] {\\n  grid-area: main;\\n  display: flex;\\n  flex: 1 1 0px;\\n}\\n\\n.map-container[_ngcontent-%COMP%] {\\n  display: flex;\\n  flex-direction: column;\\n  align-items: center;\\n  border: solid red 1px;\\n  width: 50%;\\n}\\n\\n.map[_ngcontent-%COMP%] {\\n  width: 100%;\\n}\\n\\n.map[_ngcontent-%COMP%]   *[_ngcontent-%COMP%] {\\n  width: 100%;\\n}\\n\\n.restaurants-list-container[_ngcontent-%COMP%] {\\n  display: flex;\\n  flex-direction: column;\\n  align-items: center;\\n  overflow-y: auto;\\n  overflow-x: hidden;\\n  border: solid red 1px;\\n  width: 50%;\\n}\\n\\n.ratings[_ngcontent-%COMP%] {\\n  color: red;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5jb21wb25lbnQuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLGVBQUE7RUFDQSxhQUFBO0VBQ0EsYUFBQTtBQUNGOztBQUVBO0VBQ0UsYUFBQTtFQUNBLHNCQUFBO0VBQ0EsbUJBQUE7RUFDQSxxQkFBQTtFQUNBLFVBQUE7QUFDRjs7QUFFQTtFQUNFLFdBQUE7QUFDRjs7QUFBRTtFQUNFLFdBQUE7QUFFSjs7QUFFQTtFQUNFLGFBQUE7RUFDQSxzQkFBQTtFQUNBLG1CQUFBO0VBQ0EsZ0JBQUE7RUFDQSxrQkFBQTtFQUNBLHFCQUFBO0VBQ0EsVUFBQTtBQUNGOztBQUVBO0VBQ0UsVUFBQTtBQUNGIiwiZmlsZSI6ImFwcC5jb21wb25lbnQuc2NzcyIsInNvdXJjZXNDb250ZW50IjpbIi5wYWdlLWNvbnRlbnQge1xuICBncmlkLWFyZWE6IG1haW47XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGZsZXg6IDEgMSAwcHg7XG59XG5cbi5tYXAtY29udGFpbmVyIHtcbiAgZGlzcGxheTogZmxleDtcbiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgYm9yZGVyOiBzb2xpZCByZWQgMXB4O1xuICB3aWR0aDogNTAlO1xufVxuXG4ubWFwIHtcbiAgd2lkdGg6IDEwMCU7XG4gICoge1xuICAgIHdpZHRoOiAxMDAlO1xuICB9XG59XG5cbi5yZXN0YXVyYW50cy1saXN0LWNvbnRhaW5lciB7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gIG92ZXJmbG93LXk6IGF1dG87XG4gIG92ZXJmbG93LXg6IGhpZGRlbjtcbiAgYm9yZGVyOiBzb2xpZCByZWQgMXB4O1xuICB3aWR0aDogNTAlO1xufVxuXG4ucmF0aW5ncyB7XG4gIGNvbG9yOiByZWQ7XG59XG4iXX0= */\"]\n});","map":{"version":3,"sources":["/home/gerry/workspace/angular-projects/gerry-advisor/src/app/app.component.ts"],"names":["forkJoin","Observable","map","switchMap","addRestaurant","removeRestaurant","selectRestaurants","i0","i1","i2","i3","i4","i5","i6","AppComponent_map_marker_7_Template","rf","ctx","ɵɵelement","position_r1","$implicit","ctx_r0","ɵɵnextContext","ɵɵproperty","markerOptions","AppComponent","constructor","store","restaurantsService","title","googleMapOptions","google","maps","Map","infoWindow","InfoWindow","restaurants$","select","restaurantsWithRatings$","markerInfos","titles","positions","draggable","ngOnInit","navigator","geolocation","getCurrentPosition","position","pos","lat","coords","latitude","lng","longitude","setMapPos","getRestaurants","pipe","restaurants","restaurant","getRestaurantRatings","subscribe","restaurantsWithRatings","restaurantWithRatings","setRestaurantMarkersInfos","handleLocationError","getCenter","onAdd","restaurantId","dispatch","onRemove","zoomOnRestaurant","long","console","log","zoom","center","push","restaurantName","getReviews","id","ratings","browserHasGeolocation","setPosition","setContent","open","ɵfac","AppComponent_Factory","t","ɵɵdirectiveInject","Store","GooglePlacesService","ɵcmp","ɵɵdefineComponent","type","selectors","decls","vars","consts","template","AppComponent_Template","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","ɵɵtemplate","ɵɵlistener","AppComponent_Template_app_restaurant_list_add_11_listener","$event","AppComponent_Template_app_restaurant_list_zoomOnRestaurant_11_listener","ɵɵpipe","ɵɵadvance","ɵɵpipeBind1","directives","GoogleMap","NgForOf","MapMarker","RestaurantListComponent","RouterOutlet","pipes","AsyncPipe","styles"],"mappings":"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","sourcesContent":["import { forkJoin, Observable } from 'rxjs';\nimport { map, switchMap } from 'rxjs/operators';\nimport { addRestaurant, removeRestaurant } from './store/restaurants.actions';\nimport { selectRestaurants, } from './store/restaurants.selector';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ngrx/store\";\nimport * as i2 from \"./restaurant-list/restaurants.service\";\nimport * as i3 from \"@angular/google-maps\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"./restaurant-list/restaurant-list.component\";\nimport * as i6 from \"@angular/router\";\nfunction AppComponent_map_marker_7_Template(rf, ctx) { if (rf & 1) {\n    i0.ɵɵelement(0, \"map-marker\", 9);\n} if (rf & 2) {\n    const position_r1 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"position\", position_r1)(\"options\", ctx_r0.markerOptions);\n} }\nexport class AppComponent {\n    constructor(store, restaurantsService) {\n        this.store = store;\n        this.restaurantsService = restaurantsService;\n        this.title = 'gerry-advisor';\n        this.googleMapOptions = {};\n        this.map = google.maps.Map;\n        this.infoWindow = google.maps.InfoWindow;\n        this.restaurants$ = this.store.select(selectRestaurants);\n        //this.restaurantCollection$ = this.store.select(selectRestaurantCollection);\n        this.restaurantsWithRatings$ = new Observable();\n        this.markerInfos = { titles: [], positions: [] };\n        this.markerOptions = { draggable: false };\n    }\n    ngOnInit() {\n        if (navigator.geolocation) {\n            navigator.geolocation.getCurrentPosition((position) => {\n                const pos = {\n                    lat: position.coords.latitude,\n                    lng: position.coords.longitude,\n                };\n                this.setMapPos(pos, 15);\n                this.restaurantsWithRatings$ = this.restaurantsService\n                    .getRestaurants(pos)\n                    .pipe(map((restaurants) => restaurants.map((restaurant) => this.getRestaurantRatings(restaurant))), switchMap((restaurantsWithRatings$) => forkJoin(restaurantsWithRatings$)));\n                this.restaurantsWithRatings$.subscribe((restaurantsWithRatings) => {\n                    restaurantsWithRatings.map((restaurantWithRatings) => {\n                        this.setRestaurantMarkersInfos(restaurantWithRatings.restaurant);\n                    });\n                });\n            });\n        }\n        else {\n            // Browser doesn't support Geolocation\n            this.handleLocationError(false, this.infoWindow, this.map.getCenter());\n        }\n    }\n    onAdd(restaurantId) {\n        this.store.dispatch(addRestaurant({ restaurantId }));\n    }\n    onRemove(restaurantId) {\n        this.store.dispatch(removeRestaurant({ restaurantId }));\n    }\n    zoomOnRestaurant(restaurant) {\n        const pos = {\n            lat: restaurant.lat,\n            lng: restaurant.long,\n        };\n        this.setMapPos(pos, 18);\n        console.log('gMapOptions: ', this.googleMapOptions);\n    }\n    setMapPos(pos, zoom) {\n        this.googleMapOptions = {\n            center: { lat: pos.lat, lng: pos.lng },\n            zoom: zoom,\n        };\n    }\n    setRestaurantMarkersInfos(restaurant) {\n        this.markerInfos.positions.push({\n            lat: restaurant.lat,\n            lng: restaurant.long,\n        });\n        this.markerInfos.titles.push(restaurant.restaurantName);\n    }\n    getRestaurantRatings(restaurant) {\n        return this.restaurantsService\n            .getReviews(restaurant.id)\n            .pipe(map((ratings) => ({ restaurant, ratings })));\n    }\n    handleLocationError(browserHasGeolocation, infoWindow, pos) {\n        infoWindow.setPosition(pos);\n        infoWindow.setContent(browserHasGeolocation\n            ? 'Error: The Geolocation service failed.'\n            : \"Error: Your browser doesn't support geolocation.\");\n        infoWindow.open(this.map);\n    }\n}\nAppComponent.ɵfac = function AppComponent_Factory(t) { return new (t || AppComponent)(i0.ɵɵdirectiveInject(i1.Store), i0.ɵɵdirectiveInject(i2.GooglePlacesService)); };\nAppComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: AppComponent, selectors: [[\"app-root\"]], decls: 15, vars: 5, consts: [[1, \"page-container\"], [1, \"page-header\"], [1, \"page-content\"], [1, \"map-container\"], [1, \"map\", 3, \"options\"], [3, \"position\", \"options\", 4, \"ngFor\", \"ngForOf\"], [1, \"restaurants-list-container\"], [3, \"restaurantsWithRatings\", \"add\", \"zoomOnRestaurant\"], [1, \"page-footer\"], [3, \"position\", \"options\"]], template: function AppComponent_Template(rf, ctx) { if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵelement(1, \"header\", 1);\n        i0.ɵɵelementStart(2, \"div\", 2);\n        i0.ɵɵelementStart(3, \"section\", 3);\n        i0.ɵɵelementStart(4, \"h2\");\n        i0.ɵɵtext(5, \"Map\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"google-map\", 4);\n        i0.ɵɵtemplate(7, AppComponent_map_marker_7_Template, 1, 2, \"map-marker\", 5);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(8, \"section\", 6);\n        i0.ɵɵelementStart(9, \"h2\");\n        i0.ɵɵtext(10, \"Liste des restaurants\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(11, \"app-restaurant-list\", 7);\n        i0.ɵɵlistener(\"add\", function AppComponent_Template_app_restaurant_list_add_11_listener($event) { return ctx.onAdd($event); })(\"zoomOnRestaurant\", function AppComponent_Template_app_restaurant_list_zoomOnRestaurant_11_listener($event) { return ctx.zoomOnRestaurant($event); });\n        i0.ɵɵpipe(12, \"async\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(13, \"footer\", 8);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(14, \"router-outlet\");\n    } if (rf & 2) {\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"options\", ctx.googleMapOptions);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngForOf\", ctx.markerInfos.positions);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"restaurantsWithRatings\", i0.ɵɵpipeBind1(12, 3, ctx.restaurantsWithRatings$));\n    } }, directives: [i3.GoogleMap, i4.NgForOf, i3.MapMarker, i5.RestaurantListComponent, i6.RouterOutlet], pipes: [i4.AsyncPipe], styles: [\".page-content[_ngcontent-%COMP%] {\\n  grid-area: main;\\n  display: flex;\\n  flex: 1 1 0px;\\n}\\n\\n.map-container[_ngcontent-%COMP%] {\\n  display: flex;\\n  flex-direction: column;\\n  align-items: center;\\n  border: solid red 1px;\\n  width: 50%;\\n}\\n\\n.map[_ngcontent-%COMP%] {\\n  width: 100%;\\n}\\n\\n.map[_ngcontent-%COMP%]   *[_ngcontent-%COMP%] {\\n  width: 100%;\\n}\\n\\n.restaurants-list-container[_ngcontent-%COMP%] {\\n  display: flex;\\n  flex-direction: column;\\n  align-items: center;\\n  overflow-y: auto;\\n  overflow-x: hidden;\\n  border: solid red 1px;\\n  width: 50%;\\n}\\n\\n.ratings[_ngcontent-%COMP%] {\\n  color: red;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5jb21wb25lbnQuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLGVBQUE7RUFDQSxhQUFBO0VBQ0EsYUFBQTtBQUNGOztBQUVBO0VBQ0UsYUFBQTtFQUNBLHNCQUFBO0VBQ0EsbUJBQUE7RUFDQSxxQkFBQTtFQUNBLFVBQUE7QUFDRjs7QUFFQTtFQUNFLFdBQUE7QUFDRjs7QUFBRTtFQUNFLFdBQUE7QUFFSjs7QUFFQTtFQUNFLGFBQUE7RUFDQSxzQkFBQTtFQUNBLG1CQUFBO0VBQ0EsZ0JBQUE7RUFDQSxrQkFBQTtFQUNBLHFCQUFBO0VBQ0EsVUFBQTtBQUNGOztBQUVBO0VBQ0UsVUFBQTtBQUNGIiwiZmlsZSI6ImFwcC5jb21wb25lbnQuc2NzcyIsInNvdXJjZXNDb250ZW50IjpbIi5wYWdlLWNvbnRlbnQge1xuICBncmlkLWFyZWE6IG1haW47XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGZsZXg6IDEgMSAwcHg7XG59XG5cbi5tYXAtY29udGFpbmVyIHtcbiAgZGlzcGxheTogZmxleDtcbiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgYm9yZGVyOiBzb2xpZCByZWQgMXB4O1xuICB3aWR0aDogNTAlO1xufVxuXG4ubWFwIHtcbiAgd2lkdGg6IDEwMCU7XG4gICoge1xuICAgIHdpZHRoOiAxMDAlO1xuICB9XG59XG5cbi5yZXN0YXVyYW50cy1saXN0LWNvbnRhaW5lciB7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gIG92ZXJmbG93LXk6IGF1dG87XG4gIG92ZXJmbG93LXg6IGhpZGRlbjtcbiAgYm9yZGVyOiBzb2xpZCByZWQgMXB4O1xuICB3aWR0aDogNTAlO1xufVxuXG4ucmF0aW5ncyB7XG4gIGNvbG9yOiByZWQ7XG59XG4iXX0= */\"] });\n"]},"metadata":{},"sourceType":"module"}